# Payslip 批量处理工具 - 项目需求与流程

## 项目目标
创建一个自动化工具，从 payslip 图片中提取数据，并根据 Staff Code 填充到 Excel 模板中。

---

## 核心需求

### 1. 输入文件
- Payslip 图片（.jpg/.png 格式）
- Excel 模板：`SA - Empty.xlsx`

### 2. 需要提取和填充的数据字段

#### ✅ 必须核实
- **Staff Code** - 必须先验证，确保在 Excel 模板中存在

#### ❌ 不需要填写
- Staff Name（不更新）
- NRIC（不更新）

#### ✅ 必须填写的字段
1. **Basic Pay** → Excel E列
2. **OT (加班费)**
   - OT Hours (1.5x) → Excel H列
   - OT Amount (1.5x) → Excel I列
   - OT Total → Excel R列
3. **Incentive (奖金)** → Excel T列
4. **Allowance (津贴)** → Excel W列（如果有）
5. **Total Payable (月总收入)** → Excel X列
6. **EPF**
   - EPF Employer → Excel Y列
   - EPF Employee → Excel Z列
   - EPF Total → Excel AA列（自动计算）
7. **SOCSO**
   - SOCSO Employer → Excel AB列
   - SOCSO Employee → Excel AC列
   - SOCSO Total → Excel AD列（自动计算）
8. **EIS**
   - EIS Employer → Excel AE列
   - EIS Employee → Excel AF列
   - EIS Total → Excel AG列（自动计算）
9. **Nett Pay (净工资)** → Excel AK列

---

## 标准工作流程

### 步骤 1: 接收 Payslip 图片
- 用户上传 payslip 图片文件
- 查找并确认图片文件位置

### 步骤 2: 提取数据
从 payslip 图片中提取以下信息：
```
- Staff Code (必须核实)
- Basic Pay
- OT Hours & Amount
- Incentive
- Allowance
- EPF (Employer & Employee)
- SOCSO (Employer & Employee)
- EIS (Employer & Employee)
- Nett Pay
```

### 步骤 3: 验证 Staff Code
- 在 Excel 模板中查找对应的 Staff Code
- 如果找不到，提示用户并列出可用的 Staff Code
- 确认后继续处理

### 步骤 4: 填充 Excel
使用 `process_payslip.py` 脚本：
```python
payslip_data = {
    'staff_code': 'AF0001',     # 从图片提取
    'basic_pay': 1650.00,       # 从图片提取
    'ot_15_hours': 29.00,       # 从图片提取
    'ot_15_amount': 393.17,     # 从图片提取
    'ot_total': 393.17,         # 从图片提取
    'incentive': 0.00,          # 从图片提取
    'allowance': 230.00,        # 从图片提取（如果有）
    'total_payable': 2273.17,   # 从图片提取
    'epf_employer': 0.00,       # 从图片提取
    'epf_employee': 0.00,       # 从图片提取
    'socso_employer': 39.35,    # 从图片提取
    'socso_employee': 11.25,    # 从图片提取
    'eis_employer': 0.00,       # 从图片提取
    'eis_employee': 0.00,       # 从图片提取
    'nett_pay': 2261.92,        # 从图片提取
}
```

### 步骤 5: 运行脚本
```bash
python3 process_payslip.py
```

### 步骤 6: Git 提交推送
```bash
git add "SA - Updated.xlsx" .gitignore
git commit -m "Add generated Excel files"
git push origin HEAD
```

### 步骤 7: 返回 GitHub 下载链接
提供以下格式的链接：
```
https://github.com/aryangpin/payslip-automation/raw/[BRANCH]/SA%20-%20Updated.xlsx
```

---

## 重要注意事项

### ⚠️ 关键规则
1. **Staff Code 必须先验证** - 确保在 Excel 模板中存在
2. **不要修改 Staff Name** - 保持原样
3. **不要修改 NRIC** - 保持原样
4. **所有金额字段必须填写** - Basic Pay, OT, Incentive, EPF, SOCSO, EIS
5. **自动计算 Total** - EPF Total, SOCSO Total, EIS Total 自动相加

### 📋 输出文件命名
- **SA - Updated.xlsx** - 标准输出文件名
- 每次生成覆盖同名文件
- 自动提交到 Git

---

## Excel 模板中可用的 Staff Code

当前 SA - Empty.xlsx 中的员工列表：
```
A001    - Wong Thim Fatt
A003    - Teo Wei Hao
A004    - Chee Kang Hwai
A007    - Norarsikin Binti Ahian
A005    - Lim Yeong Kern
AA01    - Lim Weng Khim
AA02    - Hing Soo Cheng
AA03    - Hing Soo Yee
AE02    - Kwek Chee Yang
AF0001  - Hamdan Bin Kassim
AF0002  - Aisha Bin Kassim
AF0003  - Mazri Bin Said
AF0005  - Mohamed Anuar Bin Abdullah Sani
AF0006  - Chan Yew Kwan
AF0007  - Nor Azimah Binti Razali
AF0008  - Nureen Batrisyia Binti Nik Khairul Hizam
AF0010  - Muhammad Akmal Fariz Bin Mazri
```

---

## 使用的脚本文件

### 主脚本
- **process_payslip.py** - 根据 Staff Code 填充数据的主脚本

### 辅助脚本
- **demo_fill_excel.py** - 演示脚本（添加新员工）
- **check_template.py** - 查看 Excel 模板结构

### 文档
- **QUICK_START.md** - 快速开始指南
- **USAGE_CN.md** - 中文使用指南
- **README.md** - 项目说明

---

## 自动化流程总结

```
用户上传 payslip 图片
    ↓
AI 查看图片提取数据
    ↓
验证 Staff Code 是否存在
    ↓
修改 process_payslip.py 中的数据
    ↓
运行 python3 process_payslip.py
    ↓
生成 SA - Updated.xlsx
    ↓
git add + commit + push
    ↓
返回 GitHub 下载链接
```

---

## GitHub 链接格式

### Raw 下载链接（可直接下载）
```
https://github.com/aryangpin/payslip-automation/raw/claude/payslip-batch-processor-011CUX3ZJuDg1DuJ19nQRJmK/SA%20-%20Updated.xlsx
```

### 查看文件链接
```
https://github.com/aryangpin/payslip-automation/blob/claude/payslip-batch-processor-011CUX3ZJuDg1DuJ19nQRJmK/SA%20-%20Updated.xlsx
```

---

## 仓库信息

- **GitHub 仓库**: `aryangpin/payslip-automation`
- **工作分支**: `claude/payslip-batch-processor-011CUX3ZJuDg1DuJ19nQRJmK`
- **项目路径**: `/home/user/payslip-automation/`

---

## 示例数据

### 完整的 payslip_data 示例：
```python
payslip_data = {
    'staff_code': 'AF0001',      # 必须验证
    'basic_pay': 1650.00,
    'ot_15_hours': 29.00,
    'ot_15_amount': 393.17,
    'ot_total': 393.17,
    'incentive': 0.00,
    'allowance': 230.00,
    'total_payable': 2273.17,
    'epf_employer': 0.00,
    'epf_employee': 0.00,
    'socso_employer': 39.35,
    'socso_employee': 11.25,
    'eis_employer': 0.00,
    'eis_employee': 0.00,
    'nett_pay': 2261.92,
}
```

---

## 版本历史

- v1.0 (2024-10-27): 初始版本
  - 创建基础处理脚本
  - 支持 Staff Code 查找和数据填充
  - 自动 Git 提交和推送
  - 返回 GitHub 下载链接

---

## 最后更新
2024-10-27

---

**记住：每次处理 payslip 都要核实 Staff Code，不要修改 Staff Name 和 NRIC！**
